<div class="dashboard-data-set" data-line="appartements">
  <div class="d-flex">
    <%= render partial: 'shared/dashboard', locals: { flats: @flats, schedules: @schedules, documents: @documents} %>
    <div style=" width:100%;">
      <%= render partial: 'shared/navbar_dashboard', locals: { page_title: 'Appartements'}%>
      <div class="container d-flex justify-content-between">
        <% if @flat.photos.attached? %>
          <div class="card-flat">
            <div class="card-trip">
              <div id="carouselExampleIndicators" class="carousel slide" data-ride="carousel">
                <div class="carousel-inner">
                  <div class="carousel-item active">
                    <%= cl_image_tag @flat.photos[0].key, class: "d-block w-100 image", style: "height: 300px"%>
                  </div>
                  <% @flat.photos[1..@flat.photos.count].each do |photo| %>
                    <div class="carousel-item ">
                      <%= cl_image_tag photo.key, class: "d-block w-100 image", style: "height: 300px"%>
                    </div>
                  <% end %>
                  <a class="carousel-control-prev" href="#carouselExampleIndicators" role="button" data-slide="prev">
                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                    <span class="sr-only">Previous</span>
                  </a>
                  <a class="carousel-control-next" href="#carouselExampleIndicators" role="button" data-slide="next">
                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                    <span class="sr-only">Next</span>
                  </a>
                </div>
              </div>
            </div>
          </div>
        <% end %>
        <div class="card-locataire">
          <div class="container">
            <% if @flat.rentings&.last&.user.nil? %>
              <h3>Où est votre annonce</h3>
              <div class="center-card-locataire">
                <ul>
                  <div class="card-locataire-inside">
                    <li> PAP </li>
                    <li>
                      <% if @flat.pap == true %>
                        <i class="fas fa-check-square"></i>
                      <% else %>
                        <i class="fas fa-times-circle"></i>
                      <% end %>
                      </li>
                  </div>
                  <div class="card-locataire-inside">
                    <li> Leboncoin </li>
                    <li>
                      <% if @flat.leboncoin == true %>
                        <i class="fas fa-check-square"></i>
                          <%= @flat.leboncoin %>
                        <% else %>
                          <i class="fas fa-times-circle"></i>
                      <% end %>
                      </li>
                  </div>
                  <div class="card-locataire-inside">
                    <li> Seloger </li>
                    <li>
                      <% if @flat.seloger == true %>
                        <i class="fas fa-check-square"></i>
                      <% else %>
                        <i class="fas fa-times-circle"></i>
                      <% end %>
                    </li>
                  </div>
                  <div class="card-locataire-inside">
                    <li> Bienici </li>
                    <li>
                      <% if @flat.bienici == true %>
                        <i class="fas fa-check-square"></i>
                      <% else %>
                        <i class="fas fa-times-circle"></i>
                      <% end %>
                    </li>
                  </div>
                  <div class="card-locataire-inside mt-4">
                    <%= link_to "Modifier", edit_flat_path(@flat), class: 'koobo-button' %>
                    <%= link_to "Supprimer", '#', class: 'koobo-button' %>
                  </div>
                </ul>
              </div>
            <% else %>
              <div id="coral-visite">Locataire</div>
              <% if @flat.rentings&.last&.user&.photo&.attached?  %>
                <%= cl_image_tag @flat.rentings.last.user.photo.key, class: 'avatar-extra-large' %>
              <% else %>
                <%= image_tag ("avatar.png"), class: "avatar-extra-large" %>
              <% end %>
              <h3><%= @flat.rentings.last.user.first_name %><%= @flat.rentings.last.user.last_name %></h3>
              <div class="center-card-locataire">
                <ul>
                  <li>
                    <p>Locataire depuis <%= ((Time.now - @flat.rentings.last.created_at) / 86400).to_i %> jours</p>
                  </li>
                  <li>
                    <p>Tél : <%= @flat.rentings.last.user.phone_number %></p>
                  </li>
                  <li>
                    <p>Mail : <%= @flat.rentings.last.user.email %></p>
                  </li>
                </ul>
              </div>
            <% end %>
          </div>
        </div>
      </div>
      <div class=" d-flex justify-content-between">
        <div class="flat-informations">
          <div class="d-flex justify-content-between align-items-center">
            <h2><%= @flat.name %></h2>
            <h5><%= @flat.monthly_price.round %> €/mois</h5>
          </div>
          <h4><%= @flat.address %></h4>
          <div class="calendar-placeholder">
            <div class="d-flex align-items-center mb-3">
              <p>Créneaux de visite sélectionnés </p>
              <div id="blue-visite" class="ml-3"></div>
            </div>

            <div class="container schedules-container-show">
              <table class = "table-schedules">
              <thead class = "jour">
                <tr>
                  <th class="schedules-tht">h</th>
                  <th class="schedules-th">lun</th>
                  <th class="schedules-th">mar</th>
                  <th class="schedules-th">mer</th>
                  <th class="schedules-th">jeu</th>
                  <th class="schedules-th">ven</th>
                  <th class="schedules-th">sam</th>
                  <th class="schedules-th">dim</th>
                </tr>
              </thead>
              <tbody>
                <% hour = 7 %>
                <% 13.times do %>
                <% hour += 1 %>
                <% demi = "30" %>
                <% pile = "00" %>
                <tr>
                  <th class= "schedule-th"> <%= hour %></th>
                  <% day = 0 %>
                  <% 7.times do %>
                    <% day += 1 %>
                    <% if @flat.schedules.select {|time| time.start == Time.new(2020, 3, day, hour, 0, 0)} != []%>
                      <td class = "schedules-td schedules-selected"></td>
                    <% else %>
                      <td class = "schedules-td schedules-unselected"><%=link_to "", flat_schedules_path(@flat, schedule: { start: Time.new(2020, 3, day, hour, 0, 0), end:Time.new(2020, 3, day, hour, 30, 0)}), method: :post, remote: true, class: "schedules-button" %></td>
                    <% end %>
                  <% end %>
                </tr>
                <tr>
                  <th class= "schedule-th"> <%= hour %>: <%= demi %></th>
                  <% day = 0 %>
                  <% 7.times do %>
                    <% day += 1 %>
                     <% if @flat.schedules.select {|time| time.start == Time.new(2020, 3, day,hour, 30, 0)} != []%>
                        <td class = "schedules-td schedules-selected"></td>
                     <% else %>
                        <td class = "schedules-td schedules-unselected"><%=link_to "", flat_schedules_path(@flat, schedule: { start: Time.new(2020, 3, day, hour, 30, 0), end:Time.new(2020, 3, day, (hour+1) , 0, 0)}), method: :post , class: "schedules-button" %></td>
                      <% end %>
                  <% end %>
                </tr>
                <% end %>
              </tbody>
             </table>
            </div>
          </div>
        </div>
        <div id="title-description">
          <h4>Confort et Equipement:</h4>
          <div class="d-flex">
              <div class="flat-informations-left">
                <p>
                  <% if @flat.number_of_rooms == 1 %>
                    <%= @flat.number_of_rooms %> pièce
                  <% else %>
                    <%= @flat.number_of_rooms %> pièces
                  <% end %>
                </p>
                <p>
                  <% if @flat.number_of_bedrooms == 1 %>
                    <%= @flat.number_of_bedrooms %> chambre
                  <% else %>
                    <%= @flat.number_of_bedrooms %> chambres
                  <% end %>
                </p>
                <p><%= @flat.surface.round %> m²</p>
                <p>
                  <% if @flat.floor == 1 %>
                    <%= @flat.floor %> er étage
                  <% else %>
                    <%= @flat.floor %> éme étage
                  <% end %>
                </p>
              </div>
              <%# raise %>
              <div class="flat-informations-right">
                <% if @flat.furnished %>
                      <p> Meublé : Oui</p>
                <% else %>
                  <p> Meublé : Non</p>
                <% end %>
                <% if @flat.cellar %>
                  <p> Cave : Oui</p>
                <% else %>
                  <p> Cave : Non</p>
                <% end %>
                <% if @flat.parking %>
                  <p> Parking : Oui</p>
                <% else %>
                  <p> Parking : Non</p>
                <% end %>
                <% if @flat.elevator %>
                  <p> Ascenseur : Oui</p>
                <% else %>
                  <p> Ascenseur : Non</p>
                <% end %>
                <% if @flat.balcony %>
                  <p> Balcon : Oui</p>
                <% else %>
                  <p> Balcon : Non</p>
                <% end %>
                <p>Chauffage :
                <% @flat.heating_system.each do |heating| %>
                  <%= heating %>
                  <% end %>
                </p>

              </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>


